drop table documents_vector_db;
drop table documents_vector_pca;
drop table DOCUMENTS;
drop table prompts;
drop table conversations;
drop table MONITOR_EMBEDDING_DB;
drop table MONITOR_EMBEDDING_PCA;




CREATE TABLE "CONVERSATIONS" 
   (	"ID" NUMBER, 
	"USERNAME" VARCHAR2(100 CHAR) COLLATE "USING_NLS_COMP", 
	"STARTED_ON" TIMESTAMP (6), 
	"APP_SESSION" NUMBER, 
	 CONSTRAINT "CONVERSATIONS_ID_PK" PRIMARY KEY ("ID")
  USING INDEX  ) ;

CREATE TABLE "PROMPTS" 
   (	"ID" NUMBER, 
	"CONV_ID" NUMBER NOT NULL ENABLE, 
	"PROMPT" VARCHAR2(32767 BYTE) COLLATE "USING_NLS_COMP", 
	"RESPONSE" VARCHAR2(32767 BYTE) COLLATE "USING_NLS_COMP", 
	"ASKED_ON" TIMESTAMP (6), 
	"CHATHISTORY" VARCHAR2(32767 BYTE) COLLATE "USING_NLS_COMP", 
	"REFERENCES" VARCHAR2(32767 BYTE) COLLATE "USING_NLS_COMP", 
	 CONSTRAINT "PROMPTS_ID_PK2" PRIMARY KEY ("ID")
                 USING INDEX   ENABLE, 
	 FOREIGN KEY ("CONV_ID")
	  REFERENCES "CONVERSATIONS" ("ID") ENABLE
   )  ;



  CREATE TABLE "DOCUMENTS" 
   (	"ID" NUMBER(*,0) GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"FILE_NAME" VARCHAR2(900 BYTE) COLLATE "USING_NLS_COMP", 
	"FILE_SIZE" NUMBER(*,0), 
	"FILE_TYPE" VARCHAR2(100 BYTE) COLLATE "USING_NLS_COMP", 
	"FILE_CONTENT" BLOB, 
	"FIRST_PAGE_IMAGE" BLOB, 
	"MIMETYPE" VARCHAR2(50 BYTE) COLLATE "USING_NLS_COMP", 
	 PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
   ENABLE
   ) ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_DOCUMENTS_VECTOR" 
after insert on DOCUMENTS
for each row
declare
my_job number;
begin
dbms_job.submit(job => my_job, what => 'chathistory_pkg.prc_cr_doc_vectors_db;');     
dbms_job.submit(job => my_job, what => 'chathistory_pkg.prc_cr_doc_vectors_pca;');  
end;



ALTER TRIGGER "TRG_DOCUMENTS_VECTOR" enable;
/


 CREATE TABLE "DOCUMENTS_VECTOR_DB" 
   (	"ID" NUMBER(*,0) NOT NULL ENABLE, 
	"CHUNK_ID" NUMBER, 
	"CHUNK_POS" NUMBER, 
	"CHUNK_SIZE" NUMBER, 
	"CHUNK_TXT" VARCHAR2(4000 BYTE) COLLATE "USING_NLS_COMP", 
	"EMBED_VECTOR" VECTOR, 
	 CONSTRAINT "DOCUMENTS_VECTOR_DB_PK" PRIMARY KEY ("ID", "CHUNK_ID") USING INDEX   ENABLE, 
	 CONSTRAINT "DOCUMENTS_VECTOR_DB_FK" FOREIGN KEY ("ID")  REFERENCES "DOCUMENTS" ("ID") ENABLE
   )   ;


CREATE TABLE "DOCUMENTS_VECTOR_PCA" 
   (	"ID" NUMBER(*,0) NOT NULL ENABLE, 
	"CHUNK_ID" NUMBER, 
	"CHUNK_POS" NUMBER, 
	"CHUNK_SIZE" NUMBER, 
	"CHUNK_TXT" VARCHAR2(4000 BYTE) COLLATE "USING_NLS_COMP", 
	"EMBED_VECTOR" VECTOR, 
	 CONSTRAINT "DOCUMENTS_VECTOR_PCA_PK" PRIMARY KEY ("ID", "CHUNK_ID") USING INDEX   ENABLE, 
	 CONSTRAINT "DOCUMENTS_VECTOR_PCA_FK" FOREIGN KEY ("ID")  REFERENCES "DOCUMENTS" ("ID") ENABLE
   )   ;


  CREATE TABLE "MONITOR_EMBEDDING_DB" 
   (	"ID" NUMBER(38,0), 
	"STATUS" VARCHAR2(100 BYTE) COLLATE "USING_NLS_COMP",
         CONSTRAINT "MONITOR_EMBEDDING_DB_PK" PRIMARY KEY ("ID") USING INDEX   ENABLE
   )  ;

  CREATE TABLE "MONITOR_EMBEDDING_PCA" 
   (	"ID" NUMBER(38,0), 
	"STATUS" VARCHAR2(100 BYTE) COLLATE "USING_NLS_COMP",
         CONSTRAINT "MONITOR_EMBEDDING_PCA_PK" PRIMARY KEY ("ID") USING INDEX   ENABLE
   )  ;

   CREATE SEQUENCE  "CONV_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 642 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
 CREATE SEQUENCE  "PROMPT_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 401 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;





